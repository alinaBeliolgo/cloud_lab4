# Лабораторная работа №4. Облачное хранилище данных. Amazon S3

## 1. Подготовка
![1](/image/image0.png)

## 2. Создание бакетов. Вариант B: Object Ownership Enforced (без ACL)

### Шаг 1. Создание бакетов без ACL
![pub_bucket](/image/image.png)
![priv_bucket](/image/image-1.png)

### Шаг 2. Создание IAM-пользователя и выдача прав
1. **Создание пользователя s3-uploader**
   - Через IAM → Users → Create user создали пользователя `s3-uploader`.
   - Не включали доступ в консоль (только CLI).
   - Создали Access key ID и Secret access key для работы через AWS CLI.

2. **Создание политики с минимальными правами (Least Privilege)**
   - Политика позволяет:
     - Список бакетов (`ListBucket`) для публичного и приватного бакета.
     - Полный доступ (чтение, запись, удаление) только к публичному бакету.
     - Доступ к префиксу `logs/` внутри приватного бакета.
   - Политика применяет принцип минимально необходимых прав: пользователь не может работать с другими бакетами или папками.

3. **Привязка политики к пользователю**
   - Через IAM → Users → s3-uploader → Permissions → Attach policy напрямую.
   - Применена созданная ранее политика `S3UploaderPolicy`.

## 3. Разрешение чтения из публичного бакета
Для публичного бакета отключили блокировку публичного доступа.
- Добавили Bucket Policy, разрешающую чтение (`s3:GetObject`) для папок `avatars/` и `content/`.
- Теперь все файлы внутри этих папок доступны публично по URL.

## 4. Проверка работы
1. **Настройка AWS CLI**
   - Установили AWS CLI на компьютер.
   - Настроили с помощью команд:
     ```bash
     aws configure
     ```
     Указали `Access Key ID` и `Secret Access Key` пользователя `s3-uploader`, регион и формат вывода.
![comands](/image/image-2.png)

2. **Загрузка файла в публичный бакет**
   - Использовали команду:
     ```bash
     aws s3 cp путь_к_файлу s3://cc-lab4-pub-kXX/avatars/
     ```
    ![comands2](/image/image-3.png)

   - **Важно:** не использовать `--acl`, так как бакет настроен с `Object Ownership: Bucket owner enforced`.
   - После этого файл стал доступен по публичному URL:
     https://cc-lab4-pub-k02.s3.eu-central-1.amazonaws.com/avatars/user2.jpg
    ![проверка](/image/image-4.png)


   - Загрузили файл logo.png в публичный бакет, в директорию content/, также сделав его публичным.
     ```bash
     aws s3 cp C:\Users\User\Desktop\cloudlab_4\public\content\logo.png s3://cc-lab4-pub-k02/content/
     ```
    ![проверка logo](/image/image-5.png)

   - Загрузили файл activity.csv в приватный бакет в папку logs/
   ```bash
   aws s3 cp C:\Users\User\Desktop\cloudlab_4\private\logs\activity.csv s3://cc-lab4-priv-k02/logs/
   ```
   ![приват](/image/image-6.png)
   URL загруженного приватного объекта недоступен.

## 5. Версионирование объектов
1. **Включение версионирования**
   - Перешли в **S3 → General purpose buckets →cc-lab4-pub-k02 → Properties → Bucket Versioning** для privat тоже самое
   - Нажали **Enable** для включения версионирования.
![Версионирование](/image/image-7.png)

2. **Изменили файл logo.png и загрузили его заново, чтобы увидеть создание новой версии**
![проверка_верс](/image/image-8.png)


## 6. Создание Lifecycle-правил для приватного бакета
Создали правило `logs-archive` для префикса `logs/` через **Management → Lifecycle rules → Create rule**.
![lifecycle](/image/image-9.png)
Настройки:
  - **Transition** → Standard-IA через 30 дней  
  - **Transition** → Glacier Deep Archive через 365 дней  
  - **Expiration** → удалить через 1825 дней (5 лет)

## 7.Создание статического веб-сайта на базе S3
Создали бакет `cc-lab4-web-k02` для хостинга:
  - Region: `eu-central-1`
  - Object Ownership: Bucket owner enforced
  - **Block all public access** сняли
Включили **Static website hosting**:  
  - Hosting type: Host a static website  
  - Index document: `index.html`  
- Скопировали файлы сайта в бакет и сделали их публичными 
- Открыли URL сайта → сайт заработал
![web](/image/image-10.png)
![web bucket](/image/image-11.png)
![конец](/image/image-12.png)



## Контрольные вопросы — ответы

1) Чем отличаются два способа управления доступом к бакетам в S3 (ACLs enabled vs Object Ownership — Bucket owner enforced)?
- ACLs enabled: доступ управляется через ACL на уровне бакета/объекта — можно сделать отдельные объекты публичными или приватными. Гибко, но сложнее и потенциально менее безопасно.
- Bucket owner enforced (Object Ownership): отключает влияние ACL на владение; владелец бакета автоматически владеет загруженными объектами. Проще и безопаснее — рекомендуется для современных конфигураций.

2) Что означает опция “Block all public access” и зачем нужна данная настройка?
- Блокирует публичные ACL и/или публичные политики для бакета и его объектов, предотвращая случайное открытие данных. Нужна для защиты от утечек и случайной публикации.

3) Чем отличается ключ (object key) от имени файла?
- Имя файла — локальное имя на вашем компьютере. Object key — это уникальный идентификатор объекта в бакете S3 (часто выглядит как путь, например `avatars/user1.jpg`), который однозначно определяет объект внутри бакета.

4) В чём разница между командами `aws s3 cp`, `mv` и `sync` и для чего используется флаг `--acl public-read`?
- `aws s3 cp` копирует файлы между локалом и S3 или между бакетами.
- `aws s3 mv` перемещает: копирует, затем удаляет источник.
- `aws s3 sync` синхронизирует директорию и бакет (копирует только новые/изменённые файлы).
- `--acl public-read` назначает ACL, дающий публичный доступ на чтение для объекта (включает доступ по публичному URL). При Object Ownership = Bucket owner enforced использование ACL обычно не требуется или игнорируется.

5) Что произойдёт, если выключить версионирование после его включения?
- Существующие версии сохранятся. При приостановке (suspend) новые версии не будут создаваться — загружаемые объекты будут заменять текущую без создания новых versionId; старые версии останутся и их нужно удалять вручную, если требуется очистка истории.

6) Что такое Storage Class в Amazon S3 и зачем они нужны?
- Storage Class — это класс хранения объекта (например, STANDARD, STANDARD_IA, GLACIER, DEEP_ARCHIVE). Различные классы имеют разные цены и характеристики доступа: горячее хранение для частого доступа и более дешёвые архивные классы для редкого доступа, что помогает оптимизировать затраты.


